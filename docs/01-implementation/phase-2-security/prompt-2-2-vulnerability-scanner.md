# PROMPT 2.2: VULNERABILITY SCANNER IMPLEMENTATION

## ğŸ“‹ Context

Beyond configuration (CIS), servers need protection against software vulnerabilities (CVEs).
We need a scanner that checks installed packages against a vulnerability database (Debian Security Tracker).

## ğŸ¯ Objective

Implement `VulnerabilityScanner` in `configurator/security/vuln_scanner.py`.

## ğŸ› ï¸ Requirements

### Functional

1. **Detection**: Identify installed packages and versions.
2. **Database**: Fetch CVE data (OVAL definitions or `debsecan` integration).
3. **Analysis**: Match installed versions vs vulnerable versions.
4. **Auto-Patch**: (Configurable) `apt-get install --only-upgrade <package>`.

## ğŸ“ Specifications

### Class Signature (`configurator/security/vuln_scanner.py`)

```python
class VulnerabilityScanner:
    def scan(self) -> List[Vulnerability]:
        """
        1. Get installed packages (dpkg-query).
        2. Fetch Debian Security Tracker JSON/API.
        3. Compare versions.
        """
        pass

    def patch(self, packages: List[str]):
        pass
```

## ğŸªœ Implementation Steps

1. **Dependencies**: We might need `debsecan` installed on the host, or we parse the [Debian OVAL definitions](https://www.debian.org/security/oval/) / JSON Tracker.
    - _Approach_: For this MVP, use `debsecan` tool if available, or parse a local map of "package: [cves]".
2. **Parser**:
    - Run `dpkg-query -W -f='${Package} ${Version}\n'`.
    - Compare against a known-bad list (mock this for MVP).
3. **Reporting**:
    - "Critical", "High", "Medium", "Low".

## ğŸ” Validation Checklist

- [ ] Correctly lists installed packages.
- [ ] Flags a dummy "vulnerable package" (create a test case).
- [ ] Auto-patch command triggers `apt-get install`.

---

**Output**: Python code for `configurator/security/vuln_scanner.py`.
