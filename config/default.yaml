# Debian VPS Workstation Configurator - Default Configuration
# This file contains the default values for all configuration options.

# System Configuration
system:
  hostname: dev-workstation
  timezone: UTC
  locale: en_US.UTF-8
  swap_size_gb: 2
  kernel_tuning: true

# Security Configuration (MANDATORY - Cannot be disabled)
security:
  enabled: true
  ufw:
    enabled: true
    default_incoming: deny
    default_outgoing: allow
    ssh_port: 22
    ssh_rate_limit: true
  fail2ban:
    enabled: true
    ssh_max_retry: 5
    ssh_ban_time: 3600
  ssh:
    disable_root_password: true
    disable_password_auth: false

    # SSH Key Management
    key_management:
      enabled: true
      default_key_type: ed25519 # ed25519, rsa
      rsa_bits: 4096

    rotation:
      enabled: true
      rotation_days: 90
      grace_period_days: 7
      auto_rotate: false # Require manual approval
      expiry_warning_days: 14

    monitoring:
      stale_key_threshold_days: 180

    audit:
      enabled: true
      log_file: /var/log/debian-vps-configurator/ssh-audit.log

  # Multi-Factor Authentication (2FA/MFA)
  mfa:
    enabled: false # Opt-in for users

    totp:
      issuer_name: "Debian VPS Configurator"
      time_step: 30 # seconds
      valid_window: 1 # Allow 30s time drift

    backup_codes:
      count: 10
      format: "XXXX-XXXX-XXXX"

    lockout:
      max_failed_attempts: 5
      lockout_duration_minutes: 30

    pam:
      enable_for_ssh: true
      enable_for_sudo: false # Optional, stricter

  auto_updates: true

# Role-Based Access Control
rbac:
  enabled: true
  roles_file: /etc/debian-vps-configurator/rbac/roles.yaml
  assignments_file: /etc/debian-vps-configurator/rbac/assignments.json
  audit:
    enabled: true
    log_file: /var/log/rbac-audit.log

  sudo:
    enabled: true
    generate_rules: true
    sudoers_dir: /etc/sudoers.d/
    validate_before_apply: true

    policies:
      default_deny: true

    audit:
      enabled: true
      log_file: /var/log/sudo-audit.log

    mfa:
      enabled: false # Requires PROMPT 2.5 integration
      critical_commands:
        - "iptables *"
        - "apt-get install *"
        - "rm -rf /*"

# User Lifecycle Management
users:
  lifecycle:
    enabled: true

    provisioning:
      default_shell: /bin/bash
      generate_ssh_key: true
      enable_2fa: false # Optional
      send_welcome_email: false

    offboarding:
      archive_data: true
      archive_retention_days: 2555 # 7 years
      generate_report: true

    registry:
      file: /var/lib/debian-vps-configurator/users/registry.json

    audit:
      enabled: true
      log_file: /var/log/user-lifecycle-audit.log

  activity_monitoring:
    enabled: true

    logging:
      database: /var/lib/debian-vps-configurator/activity/activity.db
      audit_log: /var/log/activity-audit.log
      retention_days: 2555 # 7 years

    anomaly_detection:
      enabled: true
      baseline_days: 30
      alert_threshold: 70 # Risk score

    alerts:
      email: security@company.com
      slack_webhook: ""
      pagerduty_key: ""

    compliance:
      standards: ["soc2", "iso27001", "hipaa"]

  teams:
    enabled: true

    shared_directories:
      base_path: /var/projects
      default_permissions: "2775"

    quotas:
      default_disk_gb: 50
      default_containers: 10

    audit:
      enabled: true
      log_file: /var/log/team-audit.log

  temp_access:
    enabled: true

    default_duration_days: 30
    max_duration_days: 90
    default_reminder_days: 7

    extension_approval_required: true
    max_extensions: 2

    emergency_access:
      enabled: true
      max_duration_hours: 4
      require_incident_id: true

    audit:
      enabled: true
      log_file: /var/log/temp-access-audit.log

# Desktop Configuration
desktop:
  enabled: true
  xrdp_port: 3389
  environment: xfce4

  # === Phase 1: XRDP Performance Settings ===
  xrdp:
    max_bpp: 24 # Color depth (24 for balance, 32 for LAN-only, 16 for slow connections)
    bitmap_cache: true # Client-side caching (huge performance win)
    security_layer: "tls" # TLS preferred over RDP security
    tcp_nodelay: true # Critical for responsiveness

  # === Phase 2: XFCE Compositor Configuration ===
  compositor:
    # Modes: disabled | optimized | enabled
    # - disabled: No compositing (recommended for remote, best performance)
    # - optimized: Compositing with VSync off, no shadows (balanced)
    # - enabled: Full compositing (LAN-only, smooth animations)
    mode: "disabled"

  # === Phase 2: Polkit Rules Configuration ===
  polkit:
    # Allow color management without password
    allow_colord: true

    # Allow package management without password
    allow_packagekit: true

  # === Phase 3: Visual Customization ===

  # Theme Configuration
  themes:
    # Themes to install (list)
    install:
      - nordic # Dark, high contrast (recommended for RDP)
      - arc # Lightweight, modern
      # - whitesur  # macOS inspired (optional, slow install)
      # - dracula   # Vibrant colors (optional)

    # Active theme to apply
    # Options: Nordic-darker, Arc-Dark, WhiteSur-Dark, Dracula
    active: "Nordic-darker"

  # Icon Pack Configuration
  icons:
    # Icon packs to install
    install:
      - papirus # Modern, colorful (recommended)
      # - tela      # Rounded, modern (optional)
      # - numix     # Flat, minimalist (optional)

    # Active icon pack
    # Options: Papirus-Dark, Tela-dark, Numix-Circle
    active: "Papirus-Dark"

  # Font Configuration
  fonts:
    # Default system font
    default: "Roboto 10"

    # Font packages are auto-installed:
    # - Roboto (sans-serif, UI)
    # - Fira Code (monospace, terminal)
    # - Noto Sans (fallback, emoji)

  # Panel Layout Configuration
  panel:
    # Layout style: macos | windows | default
    # - macos: Top panel + Plank dock at bottom
    # - windows: Bottom taskbar (Windows 11 style)
    # - default: XFCE default layout (top panel only)
    layout: "macos"

    # Plank dock auto-start
    enable_plank: true

  # === Phase 4: Zsh Configuration ===
  zsh:
    # Enable Zsh installation and configuration
    enabled: true

    # Plugins to load in .zshrc
    # Note: zsh-autosuggestions and zsh-syntax-highlighting are always installed
    plugins:
      - git # Git aliases and functions
      - docker # Docker completions
      - docker-compose # Docker Compose completions
      - kubectl # Kubernetes completions
      - sudo # ESC ESC to prepend sudo
      - command-not-found # Suggest package for unknown commands
      - colored-man-pages # Colored man pages
      - zsh-autosuggestions # Fish-like autosuggestions
      - zsh-syntax-highlighting # MUST BE LAST

    # Terminal productivity tools
    tools:
      fzf: true # Fuzzy finder (Ctrl+R for history)
      bat: true # Better cat with syntax highlighting
      eza: true # Better ls with colors/icons
      zoxide: true # Smarter cd that learns

    # Set Zsh as default shell for users
    set_default_shell: true

  # === Phase 5: Advanced Terminal Tools ===
  terminal_tools:
    # Bat configuration
    bat:
      theme: "TwoDark" # TwoDark, Monokai Extended, Nord, etc.
      line_numbers: true # Show line numbers
      git_integration: true # Show git modifications

    # Exa configuration
    exa:
      git_integration: true # Show git status per file
      icons: true # Show file type icons
      extended_attributes: false # Show extended attrs (Linux-specific)
      time_style: "long-iso" # Date format:  long-iso, iso, relative
      group_directories_first: true

    # Zoxide configuration
    zoxide:
      interactive_mode: true # Enable 'zi' command
      exclude_dirs:
        - "/tmp"
        - "/var/tmp"
      max_results: 10

    # FZF configuration
    fzf:
      preview: true # Show preview window
      height: "40%"
      layout: "reverse" # reverse | default
      border: true
      color_scheme: "dark" # dark | light

    # Optional tools (may require manual installation)
    optional:
      ripgrep: true # Fast grep (rg)
      fd: true # Fast find (fd)
      delta: true # Better git diff
      tokei: false # Code statistics
      bottom: false # Better top (btm)

# Programming Languages
languages:
  python:
    enabled: true
    version: system
    dev_tools:
      - black
      - pylint
      - mypy
      - pytest
      - ipython
  nodejs:
    enabled: true
    version: "20"
    use_nvm: true
    package_managers:
      - npm
      - yarn
      - pnpm
  golang:
    enabled: false
  rust:
    enabled: false
  java:
    enabled: false
  php:
    enabled: false

# Development Tools
tools:
  docker:
    enabled: true
    compose: true
  git:
    enabled: true
    github_cli: true
  editors:
    vscode:
      enabled: true
    cursor:
      enabled: false
    neovim:
      enabled: false

# Networking
networking:
  wireguard:
    enabled: false
  caddy:
    enabled: false

# Monitoring
monitoring:
  netdata:
    enabled: false

# Performance Tuning
performance:
  parallel_execution: true
  max_workers: 3
  package_cache:
    enabled: true
    max_size_gb: 10.0

  # Circuit Breaker Configuration
  circuit_breaker:
    enabled: true
    failure_threshold: 3 # Open after 3 failures
    timeout: 60 # Retry after 60 seconds
    success_threshold: 1 # Close after 1 success in half-open

  # Network Retry Configuration
  network_retry:
    enabled: true
    max_retries: 3
    initial_delay: 1.0 # seconds
    max_delay: 30.0 # seconds
    exponential_base: 2.0
    jitter: true # Add random jitter to prevent thundering herd

  # Timeout Configuration
  timeouts:
    apt_update: 300 # 5 minutes
    apt_install: 600 # 10 minutes
    download: 600 # 10 minutes
    git_clone: 300 # 5 minutes
    http_request: 30 # 30 seconds

  # Health Checks
  health_checks:
    enabled: true
    check_on_startup: true
    services:
      - apt_repository
      - github
      - docker_hub

# Vulnerability Scanning
vulnerability_scanning:
  enabled: true
  preferred_scanner: trivy # trivy or grype
  scan_targets:
    system: true
    docker_images: true
  auto_remediate:
    enabled: false
    severity_threshold: high # critical, high, medium, low
  monitoring:
    enabled: false
    interval_hours: 24
  reporting:
    format: [html, json]
    output_dir: reports/vulnerability

# SSL/TLS Certificate Management
ssl_certificates:
  enabled: true
  provider: letsencrypt

  letsencrypt:
    email: "" # Required for notifications
    staging: false # Use production by default

  auto_renewal:
    enabled: true
    threshold_days: 30
    schedule: "0 2 * * *" # Daily at 2 AM
    reload_webserver: true

  challenge:
    preferred: http-01 # http-01, dns-01, tls-alpn-01
    dns_plugin: "" # cloudflare, route53, etc.

  monitoring:
    enabled: true
    warning_threshold_days: 30
    critical_threshold_days: 14
    email_notifications: false
    slack_webhook: ""

  webserver:
    type: nginx # nginx, apache, caddy
    auto_configure: true

  tls_settings:
    protocols: ["TLSv1.2", "TLSv1.3"]
    ciphers: "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256"
    hsts_enabled: true
    hsts_max_age: 31536000
    ocsp_stapling: true

# ═══════════════════════════════════════════════════════════
# Phase 2: Advanced Security Features
# ═══════════════════════════════════════════════════════════

security_advanced:
  # CIS Benchmark Scanner
  cis_scanner:
    enabled: true
    level: 1 # 1 or 2 (Level 1: Basic hardening, Level 2: Strict)
    auto_remediate: false # Automatically fix issues (use with caution)
    report_path: "/var/log/cis-scan-report.html"
    scan_schedule: "weekly" # daily/weekly/monthly
    categories:
      - initial_setup
      - services
      - network
      - logging_auditing
      - access_authentication
      - system_maintenance

  # Vulnerability Scanner
  vulnerability_scanner:
    enabled: true
    scanner: "trivy" # trivy/lynis/both
    scan_on_install: false
    scan_schedule: "daily"
    severity_threshold: "HIGH" # LOW/MEDIUM/HIGH/CRITICAL
    report_path: "/var/log/vuln-scan-report.json"
    auto_update_db: true
    notify_on_critical: true

  # SSL/TLS Manager
  ssl_manager:
    enabled: false # Enable for public-facing servers
    provider: "letsencrypt" # letsencrypt/selfsigned
    domains: [] # ["example.com", "www.example.com"]
    email: "" # Required for Let's Encrypt
    auto_renew: true
    renew_days_before: 30
    web_server: "nginx" # nginx/apache

  # SSH Key Management
  ssh_key_manager:
    enabled: true
    generate_keys: true
    key_type: "ed25519" # rsa/ed25519/ecdsa
    key_size: 4096 # For RSA
    distribute_keys: false # Distribute to authorized_keys
    key_rotation_days: 365 # Rotate keys annually
    disable_password_auth: false # Only allow key-based auth

  # Multi-Factor Authentication
  mfa:
    enabled: false # Requires careful setup
    method: "totp" # totp/u2f/both
    provider: "google-authenticator"
    enforce_for_sudo: true
    enforce_for_ssh: true
    backup_codes: true
    backup_codes_count: 10

  # Supply Chain Security
  supply_chain:
    enabled: true
    verify_checksums: true
    verify_signatures: true
    verify_apt_keys: true # NEW: Verify APT repository key fingerprints

    # Strict mode: Fail if no checksum available (default: false for backward compatibility)
    strict_mode: false

    allowed_sources:
      github:
        - "github.com/ohmyzsh/ohmyzsh"
        - "github.com/romkatv/powerlevel10k"
        - "github.com/EliverLara/Nordic"
        - "github.com/ryanoasis/nerd-fonts"
      apt:
        - "deb.debian.org"
        - "security.debian.org"
        - "download.docker.com"
        - "packages.microsoft.com"
        - "cli.github.com"
        - "dl.cloudsmith.io" # Caddy
      web:
        - "raw.githubusercontent.com"

    checksum_database: "/etc/vps-configurator/checksums.db" # Legacy database
    signature_verification: "gpg"

    # Audit logging
    audit_log: "/var/log/vps-configurator/supply-chain-audit.log"

  # Input Validation
  input_validation:
    strict_mode: true
    username_pattern: "^[a-z][a-z0-9_-]{2,31}$"
    path_whitelist:
      - "/etc/xrdp/"
      - "/etc/ssh/"
      - "/usr/share/themes/"
      - "/usr/share/icons/"
      - "/home/*/"
    command_whitelist_enabled: false
    log_validation_failures: true

# Installation Options
interactive: true
verbose: false
dry_run: false

# Installation Behavior (CORE-002)
installation:
  # In non-interactive mode, automatically rollback on error
  auto_rollback_on_error: true

# =============================================================================
# OBSERVABILITY CONFIGURATION
# =============================================================================

observability:
  # Metrics Collection
  metrics:
    enabled: true
    collect_interval: 60 # seconds
    export_format: prometheus # prometheus, json
    export_path: /var/lib/vps-configurator/metrics

    # Prometheus push gateway (optional)
    push_gateway:
      enabled: false
      url: "http://localhost:9091"
      job_name: vps_configurator

  # Structured Logging
  logging:
    enabled: true
    format: json # json, text
    level: INFO # DEBUG, INFO, WARNING, ERROR, CRITICAL

    # Log files
    files:
      install: /var/log/vps-configurator/install.log
      error: /var/log/vps-configurator/error.log
      audit: /var/log/vps-configurator/audit.log

    # Rotation
    rotation:
      enabled: true
      max_bytes: 10485760 # 10MB
      backup_count: 5

  # Alerting
  alerting:
    enabled: true

    # Alert channels
    channels:
      email:
        enabled: false
        smtp_host: smtp.gmail.com
        smtp_port: 587
        smtp_user: ""
        smtp_password: ""
        from_addr: "alerts@example.com"
        to_addrs:
          - "admin@example.com"
        use_tls: true

      slack:
        enabled: false
        webhook_url: ""

      webhook:
        enabled: false
        url: ""
        headers:
          Content-Type: application/json

      file:
        enabled: true
        path: /var/log/vps-configurator/alerts.log

    # Threshold rules
    thresholds:
      circuit_breaker_opens:
        enabled: true
        value: 5
        severity: warning
        message: "Circuit breaker opened {value} times"

      module_failures:
        enabled: true
        value: 3
        severity: error
        message: "Module failures exceeded threshold"

      memory_usage:
        enabled: true
        value: 90 # percent
        severity: warning
        message: "Memory usage at {value}%"

  # Dashboard
  dashboard:
    enabled: true
    update_interval: 2.0 # seconds
    show_resources: true
    show_circuit_breakers: true

  # Tracing (optional)
  tracing:
    enabled: false
    # Jaeger configuration
    jaeger:
      host: localhost
      port: 6831
